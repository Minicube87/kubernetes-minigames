<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Snake - MiniGames</title>
    <style>
      :root {
        color-scheme: light;
        --bg: #0b0f1a;
        --panel: #111827;
        --accent: #22c55e;
        --accent-2: #38bdf8;
        --text: #e5e7eb;
        --muted: #94a3b8;
      }
      * {
        box-sizing: border-box;
      }
      html, body {
        margin: 0;
        padding: 0;
        min-height: 100%;
        background: radial-gradient(circle at top, #1f2937, var(--bg));
        font-family: "Trebuchet MS", "Segoe UI", sans-serif;
        color: var(--text);
        overscroll-behavior: contain;
      }
      .wrap {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        gap: 16px;
        padding: 16px;
        padding-bottom: calc(16px + env(safe-area-inset-bottom));
      }
      header {
        background: var(--panel);
        border-radius: 16px;
        padding: 16px;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
      }
      h1 {
        margin: 0 0 6px;
        font-size: 1.4rem;
        letter-spacing: 0.04em;
      }
      p {
        margin: 0;
        color: var(--muted);
      }
      .panel {
        background: var(--panel);
        border-radius: 16px;
        padding: 12px;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.3);
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 8px;
        font-size: 0.9rem;
      }
      .stat {
        padding: 8px 10px;
        background: #0f172a;
        border-radius: 10px;
        border: 1px solid #1f2937;
      }
      .game-area {
        display: grid;
        gap: 12px;
      }
      canvas {
        width: 100%;
        height: auto;
        display: block;
        border-radius: 12px;
        background: #0b1220;
        border: 2px solid #1f2937;
        touch-action: none;
      }
      .controls {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        grid-template-rows: repeat(3, minmax(0, 1fr));
        gap: 10px;
        justify-items: center;
        align-items: center;
        touch-action: none;
      }
      .controls button {
        border: none;
        border-radius: 14px;
        padding: 14px 10px;
        background: #111827;
        color: var(--text);
        font-weight: 700;
        letter-spacing: 0.04em;
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
      }
      .dpad-btn {
        width: 64px;
        height: 64px;
        border-radius: 18px;
        font-size: 1.4rem;
        display: grid;
        place-items: center;
        border: 1px solid #1f2937;
      }
      .dpad-btn:active {
        transform: translateY(1px) scale(0.98);
      }
      .control-center {
        display: grid;
        gap: 8px;
        width: 100%;
      }
      .control-center button {
        width: 100%;
        padding: 14px 10px;
      }
      .controls button.primary {
        background: var(--accent);
        color: #0b0f1a;
      }
      .controls button.secondary {
        background: #0f172a;
        color: var(--accent-2);
        border: 1px solid #1f2937;
      }
      .footer {
        font-size: 0.8rem;
        color: var(--muted);
        text-align: center;
      }
      @media (min-width: 700px) {
        .wrap {
          max-width: 720px;
          margin: 0 auto;
        }
      }
      @media (max-width: 430px) {
        canvas {
          max-height: 52vh;
        }
        .dpad-btn {
          width: 56px;
          height: 56px;
          font-size: 1.2rem;
        }
        .controls {
          gap: 8px;
        }
        .stat {
          font-size: 0.85rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1>Snake</h1>
        <p>Swipe on the board or use the arrows below.</p>
      </header>

      <section class="panel game-area">
        <div class="stats">
          <div class="stat" id="score">Score: 0</div>
          <div class="stat" id="best">Best: 0</div>
          <div class="stat" id="speed">Speed: 6</div>
        </div>
        <canvas id="game" width="360" height="360"></canvas>
        <div class="controls">
          <div></div>
          <button id="upBtn" class="dpad-btn secondary" aria-label="Up">▲</button>
          <div></div>
          <button id="leftBtn" class="dpad-btn secondary" aria-label="Left">◀</button>
          <div class="control-center">
            <button id="startBtn" class="primary">Start</button>
            <button id="pauseBtn">Pause</button>
          </div>
          <button id="rightBtn" class="dpad-btn secondary" aria-label="Right">▶</button>
          <div></div>
          <button id="downBtn" class="dpad-btn secondary" aria-label="Down">▼</button>
          <div></div>
        </div>
      </section>

      <div class="footer">Tip: tap Start if the snake stopped.</div>
    </div>

    <script>
      const canvas = document.getElementById("game");
      const ctx = canvas.getContext("2d");
      const scoreEl = document.getElementById("score");
      const bestEl = document.getElementById("best");
      const speedEl = document.getElementById("speed");
      const startBtn = document.getElementById("startBtn");
      const pauseBtn = document.getElementById("pauseBtn");

      const gridSize = 18;
      const cell = canvas.width / gridSize;
      let tickMs = 160;

      const state = {
        snake: [{ x: 9, y: 9 }],
        dir: { x: 1, y: 0 },
        nextDir: { x: 1, y: 0 },
        food: { x: 4, y: 4 },
        score: 0,
        best: Number(localStorage.getItem("snakeBest") || 0),
        running: false,
        paused: false,
        timerId: null,
      };

      function setDirection(x, y) {
        if (state.dir.x === -x && state.dir.y === -y) {
          return;
        }
        state.nextDir = { x, y };
      }

      function startGame() {
        if (state.timerId) {
          clearInterval(state.timerId);
        }
        state.running = true;
        state.paused = false;
        state.timerId = setInterval(step, tickMs);
      }

      function pauseGame() {
        if (!state.running) {
          return;
        }
        state.paused = !state.paused;
      }

      function resetGame() {
        state.snake = [{ x: 9, y: 9 }];
        state.dir = { x: 1, y: 0 };
        state.nextDir = { x: 1, y: 0 };
        state.score = 0;
        tickMs = 160;
        placeFood();
        updateStats();
      }

      function placeFood() {
        let spot;
        do {
          spot = {
            x: Math.floor(Math.random() * gridSize),
            y: Math.floor(Math.random() * gridSize),
          };
        } while (state.snake.some((seg) => seg.x === spot.x && seg.y === spot.y));
        state.food = spot;
      }

      function step() {
        if (!state.running || state.paused) {
          draw();
          return;
        }

        state.dir = { ...state.nextDir };
        const head = { ...state.snake[0] };
        head.x += state.dir.x;
        head.y += state.dir.y;

        if (head.x < 0 || head.x >= gridSize || head.y < 0 || head.y >= gridSize) {
          endGame();
          return;
        }
        if (state.snake.some((seg) => seg.x === head.x && seg.y === head.y)) {
          endGame();
          return;
        }

        state.snake.unshift(head);
        if (head.x === state.food.x && head.y === state.food.y) {
          state.score += 1;
          if (state.score % 4 === 0 && tickMs > 80) {
            tickMs -= 10;
            restartTimer();
          }
          placeFood();
          updateStats();
        } else {
          state.snake.pop();
        }

        draw();
      }

      function restartTimer() {
        if (!state.timerId) {
          return;
        }
        clearInterval(state.timerId);
        state.timerId = setInterval(step, tickMs);
      }

      function endGame() {
        state.running = false;
        clearInterval(state.timerId);
        state.timerId = null;
        if (state.score > state.best) {
          state.best = state.score;
          localStorage.setItem("snakeBest", String(state.best));
        }
        updateStats();
        draw(true);
      }

      function updateStats() {
        scoreEl.textContent = `Score: ${state.score}`;
        bestEl.textContent = `Best: ${state.best}`;
        speedEl.textContent = `Speed: ${Math.round(1000 / tickMs)}`;
      }

      function draw(gameOver = false) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.strokeStyle = "#1f2937";
        for (let i = 0; i <= gridSize; i++) {
          ctx.beginPath();
          ctx.moveTo(i * cell, 0);
          ctx.lineTo(i * cell, canvas.height);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(0, i * cell);
          ctx.lineTo(canvas.width, i * cell);
          ctx.stroke();
        }

        ctx.fillStyle = "#22c55e";
        state.snake.forEach((seg, idx) => {
          ctx.fillRect(seg.x * cell + 1, seg.y * cell + 1, cell - 2, cell - 2);
          if (idx === 0) {
            ctx.fillStyle = "#38bdf8";
            ctx.fillRect(seg.x * cell + 1, seg.y * cell + 1, cell - 2, cell - 2);
            ctx.fillStyle = "#22c55e";
          }
        });

        ctx.fillStyle = "#f97316";
        ctx.beginPath();
        ctx.arc(state.food.x * cell + cell / 2, state.food.y * cell + cell / 2, cell * 0.35, 0, Math.PI * 2);
        ctx.fill();

        if (gameOver) {
          ctx.fillStyle = "rgba(15, 23, 42, 0.8)";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "#ffffff";
          ctx.font = "bold 20px Trebuchet MS";
          ctx.textAlign = "center";
          ctx.fillText("Game Over", canvas.width / 2, canvas.height / 2 - 10);
          ctx.font = "14px Trebuchet MS";
          ctx.fillText("Tap Start to try again", canvas.width / 2, canvas.height / 2 + 16);
        }
      }

      function handleSwipe(startX, startY, endX, endY) {
        const dx = endX - startX;
        const dy = endY - startY;
        if (Math.abs(dx) < 10 && Math.abs(dy) < 10) {
          return;
        }
        if (Math.abs(dx) > Math.abs(dy)) {
          setDirection(dx > 0 ? 1 : -1, 0);
        } else {
          setDirection(0, dy > 0 ? 1 : -1);
        }
      }

      let touchStart = null;
      canvas.addEventListener("pointerdown", (event) => {
        event.preventDefault();
        touchStart = { x: event.clientX, y: event.clientY };
      });
      canvas.addEventListener("pointerup", (event) => {
        if (!touchStart) {
          return;
        }
        handleSwipe(touchStart.x, touchStart.y, event.clientX, event.clientY);
        touchStart = null;
      });

      startBtn.addEventListener("click", () => {
        if (!state.running) {
          resetGame();
        }
        startGame();
      });
      pauseBtn.addEventListener("click", pauseGame);
      document.getElementById("upBtn").addEventListener("click", () => setDirection(0, -1));
      document.getElementById("downBtn").addEventListener("click", () => setDirection(0, 1));
      document.getElementById("leftBtn").addEventListener("click", () => setDirection(-1, 0));
      document.getElementById("rightBtn").addEventListener("click", () => setDirection(1, 0));

      window.addEventListener("keydown", (event) => {
        if (event.key === "ArrowUp") setDirection(0, -1);
        if (event.key === "ArrowDown") setDirection(0, 1);
        if (event.key === "ArrowLeft") setDirection(-1, 0);
        if (event.key === "ArrowRight") setDirection(1, 0);
      });

      updateStats();
      draw();
    </script>
  </body>
</html>
